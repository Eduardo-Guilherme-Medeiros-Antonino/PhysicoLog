<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - PhysicoLog</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="topo">
        <h1>üß† PhysicoLog</h1>
        <p class="subtitulo">Acompanhamento e registro do bem-estar</p>
    </header>
    
    <main class="container">
        <section class="card fade-in">
            <h2>üîí Entrar no PhysicoLog</h2>
            <form id="login-form">
                <div class="input-group">
                    <label for="email">Email</label>
                    <input id="email" type="email" required class="text-input" placeholder="seu.email@exemplo.com" />
                </div>

                <div class="input-group">
                    <label for="senha">Senha</label>
                    <input id="senha" type="password" required class="text-input" placeholder="Digite sua senha" />
                </div>

                <button type="submit" id="btn-login" class="botao">Entrar</button>
                
                <div id="msg" class="mensagem-erro"></div>
            </form>
            
            <p class="cadastro-link">
                Novo por aqui? <a href="pagina_registro.html">Crie uma conta</a>
            </p>
        </section>
    </main>

<script>
    console.log("‚úÖ Script do login.html carregou!");

    async function login(event) {
        event.preventDefault();
        console.log("üü¢ Fun√ß√£o login() foi chamada");

        const email = document.getElementById("email").value;
        const senha = document.getElementById("senha").value;
        const msgElement = document.getElementById("msg");

        msgElement.innerText = "";
        msgElement.classList.remove("active");

        const res = await fetch("http://127.0.0.1:8000/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, senha })
        });

        const data = await res.json();
        console.log("Resposta do backend:", data);

        if (!res.ok) {
            msgElement.innerText = data.detail || "Erro ao conectar. Tente novamente.";
            msgElement.classList.add("active");
            return;
        }

        // üîê Armazena os dados no localStorage (atualizado)
        localStorage.setItem("token", data.access_token);
        localStorage.setItem("tipo", data.tipo);
        localStorage.setItem("email", data.email || email); // garante email mesmo se backend n√£o enviar
        localStorage.setItem("nome", data.nome || "");

        console.log("Login bem-sucedido como:", data.tipo);

        // Redirecionamento seguro com base no tipo
        setTimeout(() => {
            if (data.tipo === "professor") {
                console.log("üîÅ Redirecionando para painel_professor.html");
                window.location.href = "painel_professor.html";
            } else if (data.tipo === "aluno") {
                console.log("üîÅ Redirecionando para index.html");
                window.location.href = "index.html";
            } else {
                console.error("Tipo de usu√°rio desconhecido:", data.tipo);
            }
        }, 1000);
    }

    document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("login-form");
        if (form) {
            console.log("üß© Listener de submit adicionado com sucesso!");
            form.addEventListener("submit", login);
        } else {
            console.error("‚ùå Formul√°rio de login n√£o encontrado!");
        }
    });
</script>

</body>
</html>
